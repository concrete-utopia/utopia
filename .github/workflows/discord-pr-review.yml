name: Discord Integration - PR Review
on:
  pull_request_review:
    types: [submitted]

jobs:
  post-to-discord:
    name: Post Notification To Discord
    runs-on: ubuntu-latest
    if: ${{ !github.event.pull_request.draft }}
    steps:
      - name: Send Approval Notification
        if: ${{ github.event.review.state == 'approved' }}
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_PRS_WEBHOOK }}
          DISCORD_USERNAME: 'GitHub'
          DISCORD_AVATAR: https://octodex.github.com/images/inspectocat.jpg
          DISCORD_EMBEDS: >-
            [{
              "title": "Approved #${{ github.event.pull_request.number }} ${{ github.event.pull_request.title }}",
              "color": 3581519,
              "url": "${{ github.event.review.html_url }}",
              "footer": {
                "text": "${{ github.event.sender.login }} | ${{ github.event.repository.full_name }}",
                "icon_url": "${{ github.event.sender.avatar_url }}",
              },
            }]
        with:
          args: 'PR approved by ${{ github.event.sender.login }}'

      - name: Send Changes Requested Notification
        if: ${{ github.event.review.state == 'changes_requested' }}
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_PRS_WEBHOOK }}
          DISCORD_USERNAME: 'GitHub'
          DISCORD_AVATAR: https://octodex.github.com/images/inspectocat.jpg
          DISCORD_EMBEDS: >-
            [{
              "title": "Changes Requested #${{ github.event.pull_request.number }} ${{ github.event.pull_request.title }}",
              "color": 13313073,
              "url": "${{ github.event.review.html_url }}",
              "description": "${{ github.event.review.body }}",
              "footer": {
                "text": "${{ github.event.sender.login }} | ${{ github.event.repository.full_name }}",
                "icon_url": "${{ github.event.sender.avatar_url }}",
              },
            }]
        with:
          args: 'Changes requested by ${{ github.event.sender.login }}'
