<!DOCTYPE html>
<html>
  <head>
    <title>Parcel Sandbox</title>
    <meta charset="UTF-8" />
  </head>

  <body>
    <h1>Hello performance testing!</h1>

    <div id="entry"></div>
    <div id="status"></div>

    <div onclick="doSlowThing()">Click me for expensive computation</div>

    <script type="text/javascript">
      const ElementCount = 500

      function append1000Elements() {
        const rootDiv = document.getElementById('entry')
        for (let i = 0; i < ElementCount; i++) {
          const elementID = `elem${i}`
          const element = document.createElement('div')
          element.style.backgroundColor = 'red'

          element.style.top = `${i * 100}px`
          element.style.left = `${i * 100}px`
          element.style.width = `100px`
          element.style.height = `100px`
          element.style.position = `absolute`
          element.id = elementID
          rootDiv.appendChild(element)
        }
      }
      append1000Elements()

      const FrameTarget = 50
      let frameCount = 0
      function animateElements() {
        frameCount++

        performance.mark('frame_start')

        for (let i = 0; i < ElementCount; i++) {
          const elementID = `elem${i}`
          const element = document.getElementById(elementID)
          element.style.backgroundColor = 'red'
          const elementBox = element.getBoundingClientRect()
          element.style.top = elementBox.y + 10 + 'px'
          element.style.left = elementBox.x + 10 + 'px'
        }

        performance.mark('frame_end')
        performance.measure(`animation_frame_${frameCount}`, 'frame_start', 'frame_end')

        if (frameCount < FrameTarget) {
          requestAnimationFrame(animateElements)
        } else {
          //animation over
          document.getElementById('status').innerHTML = '<div id="done">DONE!</div>'
          performance.mark('SLOW_END')
          performance.measure('SLOW_THING', 'SLOW_START', 'SLOW_END')
        }
      }

      function doSlowThing() {
        performance.mark('SLOW_START')
        animateElements()
      }
    </script>
  </body>
</html>
